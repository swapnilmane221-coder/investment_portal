<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Design</title>
    <link rel="stylesheet" href="/static/css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
<script>
    async function sendMessage() {
        let inputField = document.getElementById("userInput");
        let userMessage = inputField.value.trim();
        if (!userMessage) return;
    
        let messageContainer = document.getElementById("messages");
        messageContainer.innerHTML += `<div class="user-msg">${userMessage}</div>`;
    
        let response = await fetch("/chatbot/", {
            method: "POST",
            headers: { "Content-Type": "application/json", "X-CSRFToken": getCookie("csrftoken") },
            body: JSON.stringify({ message: userMessage })
        });
    
        let data = await response.json();
        messageContainer.innerHTML += `<div class="bot-msg">${data.response}</div>`;
    
        inputField.value = "";
    }
    
    // Get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            let cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.startsWith(name + "=")) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    </script>
    
    <style>
    #chatbot {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        border: 1px solid #ccc;
        background: white;
        padding: 10px;
        border-radius: 5px;
    }
    #chatbox {
        display: flex;
        flex-direction: column;
    }
    #messages {
        height: 200px;
        overflow-y: auto;
        margin-bottom: 10px;
    }
    .user-msg {
        text-align: right;
        color: blue;
    }
    .bot-msg {
        text-align: left;
        color: green;
    }
    </style>
    
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo"></div>
        <ul class="menu">
            <li class="active">
                <a href="#">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistics</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-question-circle"></i>
                    <span>FAQ</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-star"></i>
                    <span>Testimonials</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </li>
            <li class="logout">
                <a href="/home">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </div>
    <!-- Main Content -->
    <div class="main--content">
        <div class="header--wrapper">
            <div class="header--title">
                <h2>StockSpy</h2>
            </div>
            <div class="user--info">
                <div class="search--box">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" placeholder="Search">
                </div>
            </div>
            <img src="./image/RG HeadshotPic.jpg" alt="Image by benzoik on Freepik">
        </div>

        <div class="card--container">
            <h3 class="main--title">Today's data</h3>
            <div class="card--wrapper">
                <div class="payment--card light--red">
                    <div class="card--header">
                        <div class="amount">
                            <span class="title">
                                Total Investment
                            </span>
                            <span class="amount--value">{{total}}</span>
                        </div>
                        <i class="fas fa-rupee-sign"></i>

                    </div>
                    
                </div>

                

                <div class="payment--card light--green">
                    <div class="card--header">
                        <div class="amount">
                            <span class="title">
                                Current Investment
                            </span>
                            <span class="amount--value">{{completed_inv}}</span>
                        </div>
                        <i class="fas fa-users icon dark--green"></i>
                    </div>
                    
                </div>

                <div class="payment--card light--blue">
                    <div class="card--header">
                        <div class="amount">
                            <span class="title">
                                sell Stock price
                            </span>
                            <span class="amount--value">{{pending_inv}}</span>
                        </div>
                        <i class="fa-solid fa-check icon dark--blue"></i>
                    
            </div>
        </div>

        <div class="tabular--wrapper">
            <h3 class="main--title"> transaction details</h3>
            <div class="table--container">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>stock Name</th>
                            <th>Amount per stock</th>
                            <th>Quantity</th>
                            <th>Status</th>
                            <th>Total amount</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% if stocktransdata %}
                        {% for i in stocktransdata %}
                        <tr>
                            <td>{{i.Date}}</td>
                            <td>{{i.name}}</td>
                            <td>{{i.amount}}</td>
                            <td>{{i.quantity}}</td>
                            <td>on {{i.status}}</td>
                            <td>{{i.total_amount}}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="6">No transaction Done</tdco>

                        </tr>
                        {% endif %}
                        
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="6">Total: {{total}}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- <div id="chatbot">
        <div id="chatbox">
            <div id="messages">{{message}}</div>
            <input type="text" id="userInput" name="userInput" placeholder="Type your message..." />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div> -->
</body>

</html>